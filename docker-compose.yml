services:
    base:
        platform: ${PLATFORM:-linux/arm64}
        image: hieumdd/bap-be-bot
        build: .
        container_name: bap-be-bot-base
        command: ["echo", "Build Completed"]

    telegram-bot:
        image: hieumdd/bap-be-bot
        depends_on:
            - base
        container_name: bap-be-bot-telegram
        entrypoint: ["python", "-m", "app.bot.telegram"]
        env_file: .env
        networks:
            - bap-be-bot

    discord-bot:
        image: hieumdd/bap-be-bot
        depends_on:
            - base
        container_name: bap-be-bot-discord
        entrypoint: ["python", "-m", "app.bot.discord"]
        env_file: .env
        networks:
            - bap-be-bot


    watchtower:
        image: containrrr/watchtower
        container_name: watchtower
        restart: always
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
            - ~/.docker/config.json:/config.json:ro
        environment:
            - WATCHTOWER_CLEANUP=true
            - WATCHTOWER_DEBUG=true
            - WATCHTOWER_POLL_INTERVAL=60

networks:
    bap-be-bot:
        driver: bridge
